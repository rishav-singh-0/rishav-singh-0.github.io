<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Compile your Custom Linux Kernel | Rishav's Digital Garden</title><meta name=keywords content="Linux,Platform/Kernel"><meta name=description content="Preparation
Install Dependencies
sudo pacman -S base-devel xmlto kmod inetutils bc libelf git --needed
Downloading source and local setup
It is recommended to create a separate build directory for your kernel(s). In this example, the directory kernelbuild will be created in the home directory:
mkdir ~/kernelbuild
cd ~/kernelbuild
Goto kernel.org and download kernel source
wget https://cdn.kernel.org/pub/linux/kernel/v5.x/linux-5.14.5.tar.xz

Note: you can verify signature of the downloaded tarball if you want
Extract tarball
tar -xvJf linux-5.14.5.tar.xz
Check
"><meta name=author content><link rel=canonical href=https://blog.rishavs.in/posts/3-resource/linux/compile-your-custom-linux-kernel/><link crossorigin=anonymous href=/assets/css/stylesheet.93f625d739f1d6a5c6f20c146bc6a8d26b233492b34b2220c54b12fd46a04ded.css integrity="sha256-k/Yl1znx1qXG8gwUa8ao0msjNJKzSyIgxUsS/UagTe0=" rel="preload stylesheet" as=style><link rel=icon href=https://blog.rishavs.in/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://blog.rishavs.in/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://blog.rishavs.in/favicon-32x32.png><link rel=apple-touch-icon href=https://blog.rishavs.in/apple-touch-icon.png><link rel=mask-icon href=https://blog.rishavs.in/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://blog.rishavs.in/posts/3-resource/linux/compile-your-custom-linux-kernel/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="https://blog.rishavs.in/posts/3-resource/linux/compile-your-custom-linux-kernel/"><meta property="og:site_name" content="Rishav's Digital Garden"><meta property="og:title" content="Compile your Custom Linux Kernel"><meta property="og:description" content="Preparation Install Dependencies sudo pacman -S base-devel xmlto kmod inetutils bc libelf git --needed Downloading source and local setup It is recommended to create a separate build directory for your kernel(s). In this example, the directory kernelbuild will be created in the home directory:
mkdir ~/kernelbuild cd ~/kernelbuild Goto kernel.org and download kernel source
wget https://cdn.kernel.org/pub/linux/kernel/v5.x/linux-5.14.5.tar.xz Note: you can verify signature of the downloaded tarball if you want
Extract tarball
tar -xvJf linux-5.14.5.tar.xz Check "><meta property="og:locale" content="en-us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-09-17T23:52:00+00:00"><meta property="article:modified_time" content="2021-09-17T23:52:00+00:00"><meta property="article:tag" content="Linux"><meta property="article:tag" content="Platform/Kernel"><meta name=twitter:card content="summary"><meta name=twitter:title content="Compile your Custom Linux Kernel"><meta name=twitter:description content="Preparation
Install Dependencies
sudo pacman -S base-devel xmlto kmod inetutils bc libelf git --needed
Downloading source and local setup
It is recommended to create a separate build directory for your kernel(s). In this example, the directory kernelbuild will be created in the home directory:
mkdir ~/kernelbuild
cd ~/kernelbuild
Goto kernel.org and download kernel source
wget https://cdn.kernel.org/pub/linux/kernel/v5.x/linux-5.14.5.tar.xz

Note: you can verify signature of the downloaded tarball if you want
Extract tarball
tar -xvJf linux-5.14.5.tar.xz
Check
"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://blog.rishavs.in/posts/"},{"@type":"ListItem","position":2,"name":"Compile your Custom Linux Kernel","item":"https://blog.rishavs.in/posts/3-resource/linux/compile-your-custom-linux-kernel/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Compile your Custom Linux Kernel","name":"Compile your Custom Linux Kernel","description":"Preparation Install Dependencies sudo pacman -S base-devel xmlto kmod inetutils bc libelf git --needed Downloading source and local setup It is recommended to create a separate build directory for your kernel(s). In this example, the directory kernelbuild will be created in the home directory:\nmkdir ~/kernelbuild cd ~/kernelbuild Goto kernel.org and download kernel source\nwget https://cdn.kernel.org/pub/linux/kernel/v5.x/linux-5.14.5.tar.xz Note: you can verify signature of the downloaded tarball if you want\nExtract tarball\ntar -xvJf linux-5.14.5.tar.xz Check ","keywords":["Linux","Platform/Kernel"],"articleBody":"Preparation Install Dependencies sudo pacman -S base-devel xmlto kmod inetutils bc libelf git --needed Downloading source and local setup It is recommended to create a separate build directory for your kernel(s). In this example, the directory kernelbuild will be created in the home directory:\nmkdir ~/kernelbuild cd ~/kernelbuild Goto kernel.org and download kernel source\nwget https://cdn.kernel.org/pub/linux/kernel/v5.x/linux-5.14.5.tar.xz Note: you can verify signature of the downloaded tarball if you want\nExtract tarball\ntar -xvJf linux-5.14.5.tar.xz Check Kernel configuration To finalise the preparation, ensure that the kernel tree is absolutely clean; do not rely on the source tree being clean after unpacking. To do so, first change into the new kernel source directory created, and then run the make mrproper command:\ncd linux-5.14.5 # cean up the tree make mrproper copy config file\nzcat /proc/config.gz \u003e .config make sure all configuration options have values that are required\nmake olddefconfig Another option(not recommended) automatically detect the hardware and creates config based on just that downside is that its not gonna detect anything which is not currently connected\nmake localmodconfig Menu driven configuration utility(best option) make menuconfig This should look somewhat like: Here is the main part of research and knowing your hardware, Good Luck üëç with that. When all the required configurations are done, save your configurations in .config file.\nBuild the kernel We can use -j flag to use multiple cores of cpu while compiling\nmake -j4 This process will normally take some time so grab a cup of coffee(it took around 1 hour for me)\nInstallation Install the modules Once the kernel has been compiled, the modules for it must follow. First build the modules:\nmake modules -j4 Change to root user\nsudo su Then install the modules.\nmake modules_install -j4 This will copy the compiled modules into /lib/modules/-. For example, for kernel version 5.14 installed above, they would be copied to /lib/modules/5.14.5-ARCH. This keeps the modules for individual kernels used separated.\nCopy the kernel to /boot directory The kernel compilation process will generate a compressed bzImage (big zImage) of that kernel, which must be copied to the /boot directory and renamed in the process. Provided the name is prefixed with vmlinuz-, you may name the kernel as you wish.\n# cp -v arch/x86_64/boot/bzImage /boot/vmlinuz- cp -v arch/x86_64/boot/bzImage /boot/vmlinuz-linux514 Make initial RAM disk Generate initramfs image file You are free to name the initramfs image file whatever you wish when generating it. However, it is recommended to use the linux convention. For example, the name ‚Äôlinux514‚Äô was given as ‚Äò5‚Äô is the major revision and ‚Äò14‚Äô is the minor revision of the 5.14 kernel. This convention will make it easier to maintain multiple kernels, regularly use mkinitcpio, and build third-party modules.\n# mkinitcpio -k -g /boot/initramfs-.img mkinitcpio -k 5.14.5 -g /boot/initramfs-linux514.img Copy System.map file The System.map file is not required for booting Linux. It is a type of ‚Äúphone directory‚Äù list of functions in a particular build of a kernel. The System.map contains a list of kernel symbols (i.e function names, variable names etc) and their corresponding addresses.\nCopy System.map to /boot, appending your kernel‚Äôs name to the destination file. Then create a symlink from /boot/System.map to point to /boot/System.map-:\ncp System.map /boot/System.map- ln -sf /boot/System.map- /boot/System.map Summary After completing all steps above, you should have the following 3 files and 1 soft symlink in your /boot directory along with any other previously existing files:\nKernel: vmlinuz- Initramfs: Initramfs-.img System Map: System.map- System Map kernel symlink Bootloader configuration For grub bootloader grub-mkconfig -o /boot/grub/grub.cfg Refrences https://wiki.archlinux.org/title/Kernel/Traditional_compilation https://www.kernel.org/ ","wordCount":"586","inLanguage":"en","datePublished":"2021-09-17T23:52:00Z","dateModified":"2021-09-17T23:52:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.rishavs.in/posts/3-resource/linux/compile-your-custom-linux-kernel/"},"publisher":{"@type":"Organization","name":"Rishav's Digital Garden","logo":{"@type":"ImageObject","url":"https://blog.rishavs.in/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://blog.rishavs.in/ accesskey=h title="Rishav's Digital Garden (Alt + H)">Rishav's Digital Garden</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://blog.rishavs.in/archives title=Archive><span>Archive</span></a></li><li><a href=https://blog.rishavs.in/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://blog.rishavs.in/tags/ title=Tags><span>Tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">Compile your Custom Linux Kernel</h1><div class=post-meta><span title='2021-09-17 23:52:00 +0000 UTC'>September 17, 2021</span>&nbsp;¬∑&nbsp;3 min</div></header><div class=post-content><h2 id=preparation>Preparation<a hidden class=anchor aria-hidden=true href=#preparation>#</a></h2><h3 id=install-dependencies>Install Dependencies<a hidden class=anchor aria-hidden=true href=#install-dependencies>#</a></h3><pre tabindex=0><code>sudo pacman -S base-devel xmlto kmod inetutils bc libelf git --needed
</code></pre><h3 id=downloading-source-and-local-setup>Downloading source and local setup<a hidden class=anchor aria-hidden=true href=#downloading-source-and-local-setup>#</a></h3><p>It is recommended to create a separate build directory for your kernel(s). In this example, the directory kernelbuild will be created in the home directory:</p><pre tabindex=0><code>mkdir ~/kernelbuild
cd ~/kernelbuild
</code></pre><p>Goto <a href=https://www.kernel.org/>kernel.org</a> and download kernel source</p><pre tabindex=0><code>wget https://cdn.kernel.org/pub/linux/kernel/v5.x/linux-5.14.5.tar.xz
</code></pre><blockquote><p>Note: you can verify signature of the downloaded tarball if you want</p></blockquote><p>Extract tarball</p><pre tabindex=0><code>tar -xvJf linux-5.14.5.tar.xz
</code></pre><p>Check
<img src=/posts/3-resource/linux/asserts/custom_kernel_tar_ls.png alt="ls command output"></p><h2 id=kernel-configuration>Kernel configuration<a hidden class=anchor aria-hidden=true href=#kernel-configuration>#</a></h2><p>To finalise the preparation, ensure that the kernel tree is absolutely clean; do not rely on the source tree being clean after unpacking. To do so, first change into the new kernel source directory created, and then run the make mrproper command:</p><pre tabindex=0><code>cd linux-5.14.5

# cean up the tree
make mrproper
</code></pre><p>copy config file</p><pre tabindex=0><code>zcat /proc/config.gz &gt; .config
</code></pre><p>make sure all configuration options have values that are required</p><pre tabindex=0><code>make olddefconfig
</code></pre><h3 id=another-optionnot-recommended>Another option(not recommended)<a hidden class=anchor aria-hidden=true href=#another-optionnot-recommended>#</a></h3><p>automatically detect the hardware and creates config based on just that
downside is that its not gonna detect anything which is not currently connected</p><pre tabindex=0><code>make localmodconfig
</code></pre><h3 id=menu-driven-configuration-utilitybest-option>Menu driven configuration utility(best option)<a hidden class=anchor aria-hidden=true href=#menu-driven-configuration-utilitybest-option>#</a></h3><pre tabindex=0><code>make menuconfig
</code></pre><p>This should look somewhat like:
<img src=/posts/3-resource/linux/asserts/custom_kernel_menuconfig.png alt="make menuconfig">
Here is the main part of research and knowing your hardware, Good Luck üëç with that.
When all the required configurations are done, save your configurations in <code>.config</code> file.</p><h2 id=build-the-kernel>Build the kernel<a hidden class=anchor aria-hidden=true href=#build-the-kernel>#</a></h2><p>We can use -j flag to use multiple cores of cpu while compiling</p><pre tabindex=0><code>make -j4
</code></pre><p>This process will normally take some time so grab a cup of coffee(it took around 1 hour for me)</p><h2 id=installation>Installation<a hidden class=anchor aria-hidden=true href=#installation>#</a></h2><h3 id=install-the-modules>Install the modules<a hidden class=anchor aria-hidden=true href=#install-the-modules>#</a></h3><p>Once the kernel has been compiled, the modules for it must follow. First build the modules:</p><pre tabindex=0><code>make modules -j4
</code></pre><p>Change to root user</p><pre tabindex=0><code>sudo su
</code></pre><p>Then install the modules.</p><pre tabindex=0><code>make modules_install -j4
</code></pre><p>This will copy the compiled modules into <code>/lib/modules/&lt;kernel_version>-&lt;config_local_version></code>. For example, for kernel version 5.14 installed above, they would be copied to <code>/lib/modules/5.14.5-ARCH</code>. This keeps the modules for individual kernels used separated.</p><h3 id=copy-the-kernel-to-boot-directory>Copy the kernel to /boot directory<a hidden class=anchor aria-hidden=true href=#copy-the-kernel-to-boot-directory>#</a></h3><p>The kernel compilation process will generate a compressed <code>bzImage</code> (big zImage) of that kernel, which must be copied to the /boot directory and renamed in the process. Provided the name is prefixed with <code>vmlinuz-</code>, you may name the kernel as you wish.</p><pre tabindex=0><code># cp -v arch/x86_64/boot/bzImage /boot/vmlinuz-&lt;kernel_name&gt;

cp -v arch/x86_64/boot/bzImage /boot/vmlinuz-linux514
</code></pre><h3 id=make-initial-ram-disk>Make initial RAM disk<a hidden class=anchor aria-hidden=true href=#make-initial-ram-disk>#</a></h3><p>Generate initramfs image file
You are free to name the initramfs image file whatever you wish when generating it. However, it is recommended to use the <code>linux&lt;major_revision>&lt;minor_revision></code> convention. For example, the name &rsquo;linux514&rsquo; was given as &lsquo;5&rsquo; is the major revision and &lsquo;14&rsquo; is the minor revision of the 5.14 kernel. This convention will make it easier to maintain multiple kernels, regularly use mkinitcpio, and build third-party modules.</p><pre tabindex=0><code># mkinitcpio -k &lt;kernel_version&gt; -g /boot/initramfs-&lt;kernel_name&gt;.img

mkinitcpio -k 5.14.5 -g /boot/initramfs-linux514.img
</code></pre><h3 id=copy-systemmap-file>Copy System.map file<a hidden class=anchor aria-hidden=true href=#copy-systemmap-file>#</a></h3><p>The <code>System.map</code> file is not required for booting Linux. It is a type of &ldquo;phone directory&rdquo; list of functions in a particular build of a kernel. The System.map contains a list of kernel symbols (i.e function names, variable names etc) and their corresponding addresses.</p><p>Copy <code>System.map</code> to <code>/boot</code>, appending your kernel&rsquo;s name to the destination file. Then create a symlink from <code>/boot/System.map</code> to point to <code>/boot/System.map-&lt;kernel_name></code>:</p><pre tabindex=0><code>cp System.map /boot/System.map-&lt;kernel_name&gt;
ln -sf /boot/System.map-&lt;kernel_name&gt; /boot/System.map
</code></pre><h2 id=summary>Summary<a hidden class=anchor aria-hidden=true href=#summary>#</a></h2><p>After completing all steps above, you should have the following 3 files and 1 soft symlink in your <code>/boot</code> directory along with any other previously existing files:</p><ul><li>Kernel: <code>vmlinuz-&lt;kernel_name></code></li><li>Initramfs: <code>Initramfs-&lt;kernel_name>.img</code></li><li>System Map: <code>System.map-&lt;kernel_name></code></li><li>System Map kernel symlink</li></ul><h2 id=bootloader-configuration>Bootloader configuration<a hidden class=anchor aria-hidden=true href=#bootloader-configuration>#</a></h2><h3 id=for-grub-bootloader>For grub bootloader<a hidden class=anchor aria-hidden=true href=#for-grub-bootloader>#</a></h3><pre tabindex=0><code>grub-mkconfig -o /boot/grub/grub.cfg
</code></pre><h2 id=refrences>Refrences<a hidden class=anchor aria-hidden=true href=#refrences>#</a></h2><ol><li><a href=https://wiki.archlinux.org/title/Kernel/Traditional_compilation>https://wiki.archlinux.org/title/Kernel/Traditional_compilation</a></li><li><a href=https://www.kernel.org/>https://www.kernel.org/</a></li></ol></div><footer class=post-footer><ul class=post-tags><li><a href=https://blog.rishavs.in/tags/linux/>Linux</a></li><li><a href=https://blog.rishavs.in/tags/platform/kernel/>Platform/Kernel</a></li></ul><nav class=paginav><a class=prev href=https://blog.rishavs.in/posts/2-area/finance/rich-dad-poor-dad-summary/><span class=title>¬´ Prev</span><br><span>Rich Dad Poor Dad Summary</span>
</a><a class=next href=https://blog.rishavs.in/posts/3-resource/linux/xfiles/><span class=title>Next ¬ª</span><br><span>xfiles</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://blog.rishavs.in/>Rishav's Digital Garden</a></span> ¬∑
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>